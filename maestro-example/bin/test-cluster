#!/bin/sh -eux

JOB="au.com.cba.omnia.maestro.example.CustomerJob"
PROJECT=$(dirname $0)/..
TARGET=${PROJECT}/target/test-cluster
JAR=${PROJECT}/target/scala-2.10/maestro-example-assembly-*.jar
JAR_NAME=$(basename ${JAR})

[ ! -d "${PROJECT}/target/test-cluster" ] || rm -rf ${PROJECT}/target/test-cluster
mkdir -p ${TARGET}
cp ${JAR} ${TARGET}/.
cp -r ${PROJECT}/src/test/resources/customer/dataFeed ${TARGET}/.

(
    cd ${TARGET}

    export HADOOP_CLASSPATH=${JAR_NAME}
    hadoop jar ${JAR_NAME} com.twitter.scalding.Tool ${JOB} \
           --hdfs \
           --env example \
           --hdfs-root example \
           --local-root . \
           --archive-root archive \
           --db-raw-prefix example
)
